<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.27.xsd"
        objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">
    <changeSet id="1731106554323-1" author="krystianwasil">
        <createSequence incrementBy="50" sequenceName="app_user_seq" startValue="1"/>
    </changeSet>
    <changeSet id="1731106554323-2" author="krystianwasil">
        <createTable tableName="app_user">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_app_user"/>
            </column>
            <column name="login" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="password" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1731106554323-3" author="krystianwasil">
        <createTable tableName="drug_treatment">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_drug_treatment"/>
            </column>
            <column name="drug_treatment" type="VARCHAR(255)"/>
            <column name="start_date" type="DATETIME"/>
            <column name="end_date" type="DATETIME"/>
            <column name="description" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet id="1731106554323-4" author="krystianwasil">
        <createTable tableName="drug_treatment_medications">
            <column name="drug_treatment_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="medication_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1731106554323-5" author="krystianwasil">
        <createTable tableName="medication">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_medication"/>
            </column>
            <column name="med_name" type="VARCHAR(255)"/>
            <column name="description" type="VARCHAR(255)"/>
            <column name="dosage" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet id="1731106554323-6" author="krystianwasil">
        <createTable tableName="patient">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_patient"/>
            </column>
            <column name="first_name" type="VARCHAR(255)"/>
            <column name="last_name" type="VARCHAR(255)"/>
            <column name="age" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="gender" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet id="1731106554323-7" author="krystianwasil">
        <createTable tableName="patient_drug_treatment">
            <column name="drug_treatment_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="patient_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1731106554323-8" author="krystianwasil">
        <createTable tableName="patient_medication">
            <column name="medication_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="patient_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1731106554323-9" author="krystianwasil">
        <createTable tableName="patient_treatment">
            <column name="patient_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="treatment_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1731106554323-10" author="krystianwasil">
        <createTable tableName="treatment">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_treatment"/>
            </column>
            <column name="treatment" type="VARCHAR(255)"/>
            <column name="description" type="VARCHAR(255)"/>
            <column name="date" type="DATETIME"/>
        </createTable>
    </changeSet>
    <changeSet id="1731106554323-11" author="krystianwasil">
        <addUniqueConstraint columnNames="login" constraintName="uc_app_user_login" tableName="app_user"/>
    </changeSet>
    <changeSet id="1731106554323-12" author="krystianwasil">
        <createIndex indexName="idx_login" tableName="app_user">
            <column name="login"/>
        </createIndex>
    </changeSet>
    <changeSet id="1731106554323-13" author="krystianwasil">
        <addForeignKeyConstraint baseColumnNames="drug_treatment_id" baseTableName="drug_treatment_medications"
                                 constraintName="fk_drutremed_on_drug_teratment" referencedColumnNames="id"
                                 referencedTableName="drug_treatment"/>
    </changeSet>
    <changeSet id="1731106554323-14" author="krystianwasil">
        <addForeignKeyConstraint baseColumnNames="medication_id" baseTableName="drug_treatment_medications"
                                 constraintName="fk_drutremed_on_medication" referencedColumnNames="id"
                                 referencedTableName="medication"/>
    </changeSet>
    <changeSet id="1731106554323-15" author="krystianwasil">
        <addForeignKeyConstraint baseColumnNames="drug_treatment_id" baseTableName="patient_drug_treatment"
                                 constraintName="fk_patdrutre_on_drug_teratment" referencedColumnNames="id"
                                 referencedTableName="drug_treatment"/>
    </changeSet>
    <changeSet id="1731106554323-16" author="krystianwasil">
        <addForeignKeyConstraint baseColumnNames="patient_id" baseTableName="patient_drug_treatment"
                                 constraintName="fk_patdrutre_on_patient" referencedColumnNames="id"
                                 referencedTableName="patient"/>
    </changeSet>
    <changeSet id="1731106554323-17" author="krystianwasil">
        <addForeignKeyConstraint baseColumnNames="medication_id" baseTableName="patient_medication"
                                 constraintName="fk_patmed_on_medication" referencedColumnNames="id"
                                 referencedTableName="medication"/>
    </changeSet>
    <changeSet id="1731106554323-18" author="krystianwasil">
        <addForeignKeyConstraint baseColumnNames="patient_id" baseTableName="patient_medication"
                                 constraintName="fk_patmed_on_patient" referencedColumnNames="id"
                                 referencedTableName="patient"/>
    </changeSet>
    <changeSet id="1731106554323-19" author="krystianwasil">
        <addForeignKeyConstraint baseColumnNames="patient_id" baseTableName="patient_treatment"
                                 constraintName="fk_pattre_on_patient" referencedColumnNames="id"
                                 referencedTableName="patient"/>
    </changeSet>
    <changeSet id="1731106554323-20" author="krystianwasil">
        <addForeignKeyConstraint baseColumnNames="treatment_id" baseTableName="patient_treatment"
                                 constraintName="fk_pattre_on_treatment" referencedColumnNames="id"
                                 referencedTableName="treatment"/>
    </changeSet>

</databaseChangeLog>